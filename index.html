<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ENFOCADOS - Oposiciones</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
/* --- ESTILO PROFESIONAL ENFOCADOS --- */
*{margin:0;padding:0;box-sizing:border-box}
:root{--Y:rgb(250,250,0);--Yd:rgb(220,220,0);--D:#1e293b;--V:#10b981;--R:#ef4444;--B:#e2e8f0}
body{font-family:'Inter',sans-serif;background:#fffef0;color:var(--D);min-height:100vh}
.wrap{max-width:800px;margin:0 auto;padding:1.5rem}
header{text-align:center;margin-bottom:2rem}
h1{font-family:'Montserrat',sans-serif;font-size:2.5rem;font-weight:800;letter-spacing:-1px}
.card{background:#fff;border-radius:20px;padding:1.8rem;box-shadow:0 10px 30px rgba(0,0,0,.05);border:2px solid var(--Y);margin-bottom:1.5rem}
.ubar{background:var(--Y);padding:.8rem;border-radius:12px;display:flex;justify-content:space-between;font-weight:600;margin-bottom:1.5rem}
.q-text{font-size:1.2rem;font-weight:600;margin-bottom:1.8rem;line-height:1.4}

/* CAJONES DE RESPUESTA */
.opt{display:flex;align-items:center;gap:1rem;padding:1.1rem;border:2px solid var(--B);border-radius:14px;cursor:pointer;margin-bottom:12px;transition:all .2s;background:#fff}
.opt:hover{border-color:var(--Y);background:#fffdf0}
.opt.ok{border-color:var(--V);background:#f0fdf4}
.opt.ko{border-color:var(--R);background:#fef2f2}
.oltr{width:32px;height:32px;border-radius:50%;background:var(--B);display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0}
.ok .oltr{background:var(--V);color:#fff}
.ko .oltr{background:var(--R);color:#fff}

/* FEEDBACK / SABER */
.fb{margin-top:1.5rem;padding:1.2rem;border-radius:12px;background:#f8fafc;border-left:5px solid var(--Y);animation:fadeIn 0.3s ease}
.fb-t{font-weight:700;text-transform:uppercase;font-size:0.85rem;margin-bottom:5px;color:var(--D)}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.btn{width:100%;padding:1rem;background:var(--Y);color:var(--D);border:none;border-radius:12px;font-size:1.1rem;font-weight:700;cursor:pointer;font-family:'Montserrat',sans-serif;transition:0.2s}
.btn:hover{background:var(--Yd)}
.btn:disabled{background:#e2e8f0;color:#94a3b8;cursor:not-allowed}
.hidden{display:none}
</style>
</head>
<body>

<div class="wrap">
    <header id="mainHeader">
        <h1 id="logo">ENFOCADOS</h1>
        <p style="color:#64748b; font-weight:500">PREMIUM ONLINE</p>
    </header>

    <div id="secLogin" class="card">
        <div style="margin-bottom:1.5rem">
            <label style="display:block;margin-bottom:.5rem;font-weight:600">Correo de acceso</label>
            <input type="email" id="inEmail" style="width:100%;padding:.8rem;border:2px solid var(--B);border-radius:10px" placeholder="tu@email.com">
        </div>
        <button class="btn" onclick="doLogin()">Acceder ahora</button>
    </div>

    <div id="secQ" class="hidden">
        <div class="ubar"><span id="qProg"></span><span id="qTimer">Test en curso</span></div>
        <div class="card">
            <div id="qTxt" class="q-text"></div>
            <div id="optsWrap"></div>
            <div id="fbWrap"></div>
            <button id="btnNext" class="btn" style="margin-top:1.5rem" onclick="nextQ()" disabled>Continuar</button>
        </div>
    </div>

    <div id="secRes" class="card hidden" style="text-align:center">
        <h2 style="font-family:'Montserrat'">Resultado Final</h2>
        <div id="rPct" style="font-size:4rem; font-weight:800; margin:1rem 0"></div>
        <button class="btn" onclick="location.reload()">Repetir Test</button>
    </div>
</div>

<script>
const apiUrl = 'https://script.google.com/macros/s/AKfycbxOW1CWs8n04Lek1Sm0mYZE_F6N0epkbvr0czCt_QzY7qdn65X3g1oya0Br2BtwXQBS/exec';
let exam = [], idx = 0, correctCount = 0;

function fetchJSONP(url, callback) {
    const name = 'jsonp_' + Date.now();
    window[name] = (data) => { delete window[name]; callback(data); };
    const s = document.createElement('script');
    s.src = `${url}${url.includes('?') ? '&' : '?'}callback=${name}`;
    document.body.appendChild(s);
}

function doLogin() {
    const email = document.getElementById('inEmail').value.trim().toLowerCase();
    if(!email) return;
    
    fetchJSONP(apiUrl + '?type=questions', function(res) {
        const headers = res.headers.map(h => h.toLowerCase().trim());
        const rows = res.rows.map(row => {
            let obj = {};
            headers.forEach((h, i) => obj[h] = row[i]);
            return obj;
        });
        exam = rows.sort(() => 0.5 - Math.random()).slice(0, 10);
        showScreen('secQ');
        showQ();
    });
}

function showScreen(id) {
    document.getElementById('secLogin').classList.add('hidden');
    document.getElementById('secQ').classList.add('hidden');
    document.getElementById('secRes').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
}

function showQ() {
    const q = exam[idx];
    document.getElementById('qProg').textContent = `Pregunta ${idx + 1} de ${exam.length}`;
    document.getElementById('qTxt').textContent = q.pregunta;
    
    const wrap = document.getElementById('optsWrap');
    wrap.innerHTML = "";
    document.getElementById('fbWrap').innerHTML = "";
    document.getElementById('btnNext').disabled = true;

    // LÓGICA DE DIVISIÓN DE OPCIONES MEJORADA
    // Divide por: Salto de línea real OR la cadena "\n" OR detectando el patrón ".b)" ".c)" ".d)"
    let rawText = q.opciones || "";
    let opts = rawText.split(/\n|\\n|(?=\.[b-d]\))/g).map(s => s.trim()).filter(s => s.length > 2);

    opts.forEach(optTxt => {
        // Limpiar restos de letras al inicio si existen (ej: "a) " o ".b) ")
        const cleanTxt = optTxt.replace(/^[a-d]\)\s*|^\.[a-d]\)\s*/i, "");
        const letter = optTxt.match(/[a-d]/i)[0].toUpperCase();

        const div = document.createElement('div');
        div.className = 'opt';
        div.innerHTML = `<div class="oltr">${letter}</div><div>${cleanTxt}</div>`;
        
        div.onclick = () => {
            if(!document.getElementById('btnNext').disabled) return;
            
            const isOk = letter === q.respuesta.trim().toUpperCase();
            if(isOk) {
                div.classList.add('ok');
                correctCount++;
            } else {
                div.classList.add('ko');
                // Marcar la correcta para que el alumno aprenda
                Array.from(wrap.children).forEach(c => {
                    if(c.querySelector('.oltr').textContent === q.respuesta.trim().toUpperCase()) c.classList.add('ok');
                });
            }

            document.getElementById('fbWrap').innerHTML = `
                <div class="fb">
                    <div class="fb-t">${isOk ? 'Respuesta Correcta' : 'Respuesta Incorrecta'}</div>
                    <div style="font-size:0.95rem; line-height:1.4">${q.motivacion || q.saber || ''}</div>
                </div>`;
            document.getElementById('btnNext').disabled = false;
        };
        wrap.appendChild(div);
    });
}

function nextQ() {
    idx++;
    if(idx < exam.length) showQ();
    else {
        document.getElementById('rPct').textContent = Math.round((correctCount/exam.length)*100) + "%";
        showScreen('secRes');
    }
}
</script>
</body>
</html>